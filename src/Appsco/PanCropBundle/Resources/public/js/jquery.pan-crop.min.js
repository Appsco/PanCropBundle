(function(d){var c=function(g,f,e){g=Math.min(e,g);g=Math.max(f,g);return g};var a=0;var b={};d.fn.panCrop=function(l){var f={init:function(m){this.panCrop.settings=d.extend({},this.panCrop.defaults,m);return this.each(function(){var n=d(this),o=n.panCrop.settings;j(n[0].src,function(q){var p=a;a++;n.data("panCropId",p);b[p]={};b[p].settings=o;b[p].crop={x:0,y:0,w:o.width,h:o.height,s:Math.max(Math.max(1,o.width/q.w),o.height/q.h)};b[p].state={originalSize:q,minScale:Math.max(o.width/q.w,o.height/q.h)};e(n);g(n);i(n);if(o.onLoad){o.onLoad.call(n)}})})},destroy:function(){var m=d(this);if(h(m)){for(var o in h(m).cssBackup){m[0].style[o]=h(m).cssBackup[o]}delete h(m).$wrapper;m.unwrap();var n=m.data("panCropId");m.unbind("mousemove.pancrop."+n+" mouseup.pancrop."+n+" mousedown.pancrop."+n)}},scale:function(n){var w=d(this);var o=h(w).settings;var u=h(w).crop;var q=h(w).state.originalSize;var p=w.width();var v=w.height();var n=c(c(n,o.width/q.w,1),o.height/q.h,1);u.s=n;k(w,u);var s=w.width()/p;var r=w.height()/v;var m=(u.x+o.width/2)*s-o.width/2;var t=(u.y+o.height/2)*r-o.height/2;u.x=c(m,0,w.width()-o.width);u.y=c(t,0,w.height()-o.height);k(w,u);return u.s},getCropData:function(){var m=d.extend({},h(d(this)).crop);m.sx=parseInt(m.x/m.s);m.sy=parseInt(m.y/m.s);m.sw=parseInt(m.w/m.s);m.sh=parseInt(m.h/m.s);return m}};var h=function(m){return b[m.data("panCropId")]||null};var e=function(m){var n=h(m).settings;var o=d("<div/>").css({width:n.width,height:n.height,overflow:"hidden"});h(m).$wrapper=o;m.wrap(o)};var g=function(m){h(m).cssBackup={};h(m).cssBackup.position=m[0].style.position;h(m).cssBackup.top=m[0].style.top;h(m).cssBackup.left=m[0].style.left;m.css("position","relative");k(m,h(m).crop)};var i=function(o){var p=h(o).settings;var q=false;var n=0;var m=0;var r=o.data("panCropId");o.on("mousedown.pancrop."+r,function(s){s.preventDefault();q=true;n=s.pageX;m=s.pageY});d(document).on("mouseup.pancrop."+r,function(){q=false});o.on("mousemove.pancrop."+r,function(v){if(q){var t=v.pageX-n;var s=v.pageY-m;n=v.pageX;m=v.pageY;var u=h(o).crop;u.x=-c(-u.x+t,p.width-o.width(),0);u.y=-c(-u.y+s,p.height-o.height(),0);k(o,u)}})};var k=function(m,n){var o=h(m).state.originalSize;m.width(o.w*n.s);m.height(o.h*n.s);m.css({left:-n.x,top:-n.y})};var j=function(n,o){var m=new Image();m.onload=function(){o({w:m.width,h:m.height})};m.src=n};if(f[l]){return f[l].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof l==="object"||!l){return f.init.apply(this,arguments)}else{d.error('Method "'+l+'" does not exist in panCrop plugin!')}}};d.fn.panCrop.defaults={};d.fn.panCrop.settings={}})(jQuery);(function(c){var a=0;var b={};c.fn.panCropUi=function(e){var d={init:function(f){this.panCropUi.settings=c.extend({},this.panCropUi.defaults,f);return this.each(function(){var j=a;var i=c(this),h=b[j]=c.extend({},i.panCropUi.settings);if(!h.$previewBox){c.error("$previewBox setting must be provided!")}if(!(window.File&&window.FileReader&&window.FileList&&window.Blob)){alert("The File APIs are not fully supported in this browser!")}var g=h.$previewBox;i.change(function(m){var l=m.target.files[0];var k=new FileReader();k.onload=function(r){var q=document.createElement("img");q.src=r.target.result;g.empty().append(q);var p=b[j].$image=c(q);p.panCrop({width:h.width||g.width(),height:h.height||g.height(),onLoad:function(){if(h.mousewheelScale){var s=p.panCrop("getCropData").s;var t=function(u){u.preventDefault();var v=h.mousewheelSensitivity*((u.wheelDelta||-u.detail)>0?1:-1);p.panCrop("scale",p.panCrop("getCropData").s+v)};p[0].addEventListener("mousewheel",t,false);p[0].addEventListener("DOMMouseScroll",t,false)}}});if(h.submitCropData){var n=h.submitCropData;var o=i.closest("form");o.on("submit.pancrop",function(s){c(n).val(JSON.stringify(p.panCrop("getCropData")))})}};k.readAsDataURL(l)});a++})}};if(d[e]){return d[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return d.init.apply(this,arguments)}else{c.error('Method "'+e+'" does not exist in panCropUi plugin!')}}};c.fn.panCropUi.defaults={mousewheelScale:true,mousewheelSensitivity:0.05};c.fn.panCropUi.settings={}})(jQuery);